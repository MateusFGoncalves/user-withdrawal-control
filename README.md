# User Withdrawal Control

Sistema web completo de controle financeiro com arquitetura de microsservi√ßos, desenvolvido para gerenciar contas digitais, dep√≥sitos e saques via PIX. Utiliza PHP Hyperf 3 no backend e React com shadcn/ui no frontend.

## üèóÔ∏è Arquitetura

O projeto segue uma arquitetura de microsservi√ßos containerizada com Docker, incluindo:

- **Backend**: PHP Hyperf 3 com autentica√ß√£o JWT
- **Frontend**: React 18 com TypeScript e shadcn/ui
- **Banco de Dados**: MySQL 8.0
- **Cache**: Redis 7
- **Reverse Proxy**: Nginx
- **Containeriza√ß√£o**: Docker e Docker Compose

## üöÄ Stack Tecnol√≥gica

### Backend
- **PHP Hyperf 3**: Framework moderno para PHP com suporte a Swoole
- **MySQL 8.0**: Banco de dados relacional para persist√™ncia de dados
- **Redis 7**: Cache e armazenamento de sess√µes
- **JWT**: Autentica√ß√£o baseada em tokens
- **Docker**: Containeriza√ß√£o do ambiente

### Frontend
- **React 18**: Biblioteca para interfaces de usu√°rio
- **TypeScript**: Tipagem est√°tica para JavaScript
- **shadcn/ui**: Biblioteca de componentes modernos e acess√≠veis
- **Tailwind CSS**: Framework CSS utilit√°rio
- **React Router**: Roteamento client-side
- **Lucide React**: √çcones modernos

### Infraestrutura
- **Docker & Docker Compose**: Orquestra√ß√£o de containers
- **Nginx**: Reverse proxy e load balancer
- **MySQL**: Banco de dados principal
- **Redis**: Cache e filas

## üìã Funcionalidades

### üîê M√≥dulo de Autentica√ß√£o
- ‚úÖ Cadastro de usu√°rios com tipos (CLIENTE/MASTER)
- ‚úÖ Login com JWT
- ‚úÖ Valida√ß√£o de tokens
- ‚úÖ Prote√ß√£o de rotas

### üë§ Perfil CLIENTE
- ‚úÖ **Dashboard e Saldo**: Visualiza√ß√£o do valor atual dispon√≠vel na conta
- ‚úÖ **M√≥dulo de Dep√≥sito**: Adicionar fundos √† conta (cr√©dito imediato)
- ‚úÖ **M√≥dulo de Saque**:
  - Saque Imediato: D√©bito instant√¢neo + valida√ß√£o de saldo
  - Saque Agendado: Agendamento at√© 7 dias (n√£o debita no momento)
  - Cancelamento de Saques Agendados: Cancelar saques pendentes
- ‚úÖ **Extrato**: Hist√≥rico completo de transa√ß√µes com filtros e pagina√ß√£o
- ‚úÖ **Exporta√ß√£o Excel**: Exportar extrato de transa√ß√µes em formato Excel
- ‚úÖ **Suporte PIX**: Saques via chave PIX (EMAIL, PHONE, CPF, RANDOM)
- ‚úÖ **M√°scara Monet√°ria**: Formata√ß√£o autom√°tica de valores em reais
- ‚úÖ **Notifica√ß√µes Toast**: Feedback visual para a√ß√µes do usu√°rio
- ‚úÖ **Interface Responsiva**: Design moderno com shadcn/ui

### üëë Perfil MASTER
- ‚úÖ **Dashboard Administrativo**: Painel com estat√≠sticas em tempo real
- ‚úÖ **Total de Clientes**: Contagem de clientes cadastrados no sistema
- ‚úÖ **Total de Fundos**: Saldo total de todas as contas do banco
- ‚úÖ **Saques Agendados**: Total de saques pendentes de todos os usu√°rios
- ‚úÖ **Transa√ß√µes Recentes**: √öltimas 4 transa√ß√µes de todos os usu√°rios
- ‚úÖ **Gest√£o de Clientes**: Listagem, visualiza√ß√£o, edi√ß√£o e cadastro de clientes
- ‚úÖ **Cadastro de Clientes**: Formul√°rio simplificado (apenas nome e email)
- ‚úÖ **Primeiro Acesso**: Cliente define sua pr√≥pria senha no primeiro login
- ‚úÖ **Pagina√ß√£o**: Sistema de pagina√ß√£o para listagem de clientes
- ‚úÖ **Filtros e Busca**: Busca por nome/email e ordena√ß√£o
- ‚úÖ **Navega√ß√£o Intuitiva**: Bot√µes de voltar e editar nos headers
- ‚úÖ **M√≥dulo de Transa√ß√µes**: Listagem completa de todas as transa√ß√µes do sistema
- ‚úÖ **Filtros Avan√ßados**: Busca por cliente, tipo, status e ordena√ß√£o
- ‚úÖ **Pagina√ß√£o Robusta**: Sistema completo com navega√ß√£o por p√°ginas
- ‚úÖ **Interface Consistente**: Design alinhado com outros m√≥dulos
- ‚úÖ **Exporta√ß√£o Excel**: Gera√ß√£o de planilhas com dados filtrados

### üé® Interface do Usu√°rio
- ‚úÖ P√°gina de login responsiva
- ‚úÖ P√°gina de cadastro com valida√ß√£o
- ‚úÖ Dashboard com sidebar e navbar
- ‚úÖ Design system consistente com shadcn/ui
- ‚úÖ Interface moderna e acess√≠vel
- ‚úÖ Modo escuro/claro

## üõ†Ô∏è Instala√ß√£o e Configura√ß√£o

### Pr√©-requisitos
- Docker
- Docker Compose
- Git

### 1. Clone o reposit√≥rio
```bash
git clone <url-do-repositorio>
cd user-withdrawal-control
```

### 2. Configure as vari√°veis de ambiente
Crie um arquivo `.env` na raiz do projeto (opcional, as configura√ß√µes padr√£o funcionam para desenvolvimento):

```env
# Backend
JWT_SECRET=your-super-secret-jwt-key-change-in-production
DB_PASSWORD=app_password

# Frontend
REACT_APP_API_URL=http://localhost/api
```

### 3. Inicie os servi√ßos
```bash
docker-compose up -d
```

### 4. Execute o script de configura√ß√£o
```bash
# Script automatizado que executa migrations e seeders
./setup.sh
```

### 5. Acesse a aplica√ß√£o
- **Frontend**: http://localhost:3000
- **API**: http://localhost:8080
- **MySQL**: localhost:3306
- **Redis**: localhost:6379

## üìä Modelos de Dados

### üè¶ Estrutura do Banco de Dados

#### **users** - Usu√°rios do Sistema
- `id` - Identificador √∫nico
- `name` - Nome completo
- `email` - Email √∫nico
- `password` - Senha hashada
- `user_type` - Tipo de acesso (CLIENTE/MASTER)
- `created_at` / `updated_at` - Timestamps

#### **accounts** - Contas Digitais
- `id` - Identificador √∫nico
- `user_id` - Refer√™ncia ao usu√°rio
- `balance` - Saldo monet√°rio (decimal 15,2)
- `created_at` / `updated_at` - Timestamps

#### **transactions** - Hist√≥rico de Transa√ß√µes
- `id` - Identificador √∫nico
- `user_id` - Refer√™ncia ao usu√°rio
- `account_id` - Refer√™ncia √† conta
- `type` - Tipo (DEPOSITO/SAQUE)
- `amount` - Valor da transa√ß√£o
- `status` - Status (PENDENTE/PROCESSADO/FALHOU/CANCELADO)
- `scheduled_at` - Data de agendamento (saques)
- `processed_at` - Data de processamento
- `failure_reason` - Motivo da falha
- `created_at` / `updated_at` - Timestamps

#### **withdrawal_details** - Detalhes de Saque PIX
- `id` - Identificador √∫nico
- `transaction_id` - Refer√™ncia √† transa√ß√£o
- `pix_type` - Tipo PIX (EMAIL/PHONE/CPF/RANDOM)
- `pix_key` - Chave PIX
- `created_at` / `updated_at` - Timestamps

## üîå API Endpoints

### üîê Autentica√ß√£o
```http
POST /api/auth/register
POST /api/auth/login
POST /api/auth/set-password
GET  /api/auth/me
```

### üí∞ Conta (Protegido - Cliente)
```http
GET /api/client/account/balance     # Consultar saldo
GET /api/client/account/info        # Informa√ß√µes da conta
```

### üí∏ Transa√ß√µes (Protegido - Cliente)
```http
POST /api/client/transactions/deposit         # Realizar dep√≥sito
POST /api/client/transactions/withdraw        # Realizar saque
POST /api/client/transactions/cancel-scheduled # Cancelar saque agendado
GET  /api/client/transactions/statement       # Consultar extrato
GET  /api/client/transactions/export-excel    # Exportar extrato para Excel
GET  /api/client/transactions/recent          # Transa√ß√µes recentes (dashboard)
```

### üëë Administra√ß√£o (Protegido - Master)
```http
GET /api/master/transactions/stats    # Estat√≠sticas administrativas
GET /api/master/transactions/recent   # Transa√ß√µes recentes de todos os usu√°rios
GET /api/master/transactions/list     # Listar todas as transa√ß√µes com filtros e pagina√ß√£o
GET /api/master/transactions/export-excel # Exportar transa√ß√µes para Excel
GET /api/master/clients/list          # Listar clientes com pagina√ß√£o
POST /api/master/clients/create       # Cadastrar novo cliente
GET /api/master/clients/{id}          # Visualizar detalhes do cliente
PUT /api/master/clients/{id}          # Editar informa√ß√µes do cliente
```

### üìù Exemplos de Uso

#### **Login**
```bash
curl -X POST http://localhost:8080/api/auth/login \
  -H "Content-Type: application/json" \
  -d '{"email": "cliente@exemplo.com", "password": "123456"}'
```

#### **Consultar Saldo (Cliente)**
```bash
curl -X GET http://localhost:8080/api/client/account/balance \
  -H "Authorization: Bearer [TOKEN]"
```

#### **Realizar Dep√≥sito (Cliente)**
```bash
curl -X POST http://localhost:8080/api/client/transactions/deposit \
  -H "Authorization: Bearer [TOKEN]" \
  -H "Content-Type: application/json" \
  -d '{"amount": 500.00}'
```

#### **Realizar Saque Imediato (Cliente)**
```bash
curl -X POST http://localhost:8080/api/client/transactions/withdraw \
  -H "Authorization: Bearer [TOKEN]" \
  -H "Content-Type: application/json" \
  -d '{"amount": 200.00, "pix_type": "EMAIL", "pix_key": "teste@exemplo.com"}'
```

#### **Realizar Saque Agendado (Cliente)**
```bash
curl -X POST http://localhost:8080/api/client/transactions/withdraw \
  -H "Authorization: Bearer [TOKEN]" \
  -H "Content-Type: application/json" \
  -d '{"amount": 100.00, "pix_type": "EMAIL", "pix_key": "teste@exemplo.com", "scheduled_at": "2025-10-25 10:00:00"}'
```

#### **Consultar Extrato (Cliente)**
```bash
curl -X GET http://localhost:8080/api/client/transactions/statement \
  -H "Authorization: Bearer [TOKEN]"
```

#### **Exportar Extrato para Excel (Cliente)**
```bash
curl -X GET "http://localhost:8080/api/client/transactions/export-excel?type=all&status=all" \
  -H "Authorization: Bearer [TOKEN]" \
  -o extrato_transacoes.xlsx
```

#### **Consultar Transa√ß√µes Recentes (Cliente)**
```bash
curl -X GET "http://localhost:8080/api/client/transactions/recent?limit=4&days=30" \
  -H "Authorization: Bearer [TOKEN]"
```

#### **Cancelar Saque Agendado (Cliente)**
```bash
curl -X POST http://localhost:8080/api/client/transactions/cancel-scheduled \
  -H "Authorization: Bearer [TOKEN]" \
  -H "Content-Type: application/json" \
  -d '{"transaction_id": 123}'
```

#### **Consultar Estat√≠sticas Administrativas (Master)**
```bash
curl -X GET http://localhost:8080/api/master/transactions/stats \
  -H "Authorization: Bearer [TOKEN]"
```

#### **Consultar Transa√ß√µes Recentes (Master)**
```bash
curl -X GET "http://localhost:8080/api/master/transactions/recent?limit=4&days=30" \
  -H "Authorization: Bearer [TOKEN]"
```

#### **Listar Todas as Transa√ß√µes (Master)**
```bash
curl -X GET "http://localhost:8080/api/master/transactions/list?page=1&limit=10&search=&type=&status=&sort_by=created_at&sort_order=desc" \
  -H "Authorization: Bearer [TOKEN]"
```

#### **Exportar Transa√ß√µes para Excel (Master)**
```bash
curl -X GET "http://localhost:8080/api/master/transactions/export-excel?search=&type=&status=" \
  -H "Authorization: Bearer [TOKEN]" \
  --output transacoes_master.xlsx
```

#### **Listar Clientes (Master)**
```bash
curl -X GET "http://localhost:8080/api/master/clients/list?page=1&limit=10" \
  -H "Authorization: Bearer [TOKEN]"
```

#### **Cadastrar Cliente (Master)**
```bash
curl -X POST http://localhost:8080/api/master/clients/create \
  -H "Authorization: Bearer [TOKEN]" \
  -H "Content-Type: application/json" \
  -d '{"name": "Jo√£o Silva", "email": "joao@exemplo.com"}'
```

#### **Definir Senha Inicial (Cliente)**
```bash
curl -X POST http://localhost:8080/api/auth/set-password \
  -H "Content-Type: application/json" \
  -d '{"email": "joao@exemplo.com", "password": "123456"}'
```

## üìã Regras de Neg√≥cio

### üí∞ Opera√ß√µes Financeiras

#### **Dep√≥sitos**
- ‚úÖ Valor deve ser maior que zero
- ‚úÖ Cr√©dito imediato na conta
- ‚úÖ Transa√ß√£o marcada como PROCESSADO
- ‚úÖ Atualiza√ß√£o autom√°tica do saldo

#### **Saques Imediatos**
- ‚úÖ Valor deve ser maior que zero
- ‚úÖ Valida√ß√£o de saldo suficiente
- ‚úÖ D√©bito imediato na conta
- ‚úÖ Transa√ß√£o marcada como PROCESSADO
- ‚úÖ Detalhes PIX obrigat√≥rios

#### **Saques Agendados**
- ‚úÖ Data de agendamento deve ser futura
- ‚úÖ Limite m√°ximo de 7 dias
- ‚úÖ Valor N√ÉO √© debitado no agendamento
- ‚úÖ Transa√ß√£o marcada como PENDENTE
- ‚úÖ Processamento via CRON (futuro)
- ‚úÖ Cancelamento permitido at√© processamento
- ‚úÖ Status CANCELADO quando cancelado pelo usu√°rio

#### **Valida√ß√µes Gerais**
- ‚úÖ Saldo nunca pode ser negativo
- ‚úÖ Valida√ß√£o de saldo no momento do saque
- ‚úÖ Chave PIX obrigat√≥ria para saques
- ‚úÖ Formata√ß√£o monet√°ria brasileira (R$ 1.000,00)

### üîê Seguran√ßa
- ‚úÖ Autentica√ß√£o JWT obrigat√≥ria
- ‚úÖ Tokens com expira√ß√£o (1 hora)
- ‚úÖ Valida√ß√£o de permiss√µes por perfil
- ‚úÖ Senhas hashadas com bcrypt
- ‚úÖ Valida√ß√£o de entrada em todas as rotas
- ‚úÖ Suporte a usu√°rios sem senha (primeiro acesso)
- ‚úÖ Verifica√ß√£o segura de senhas null

### üìä Dados de Teste
- **Cliente**: `cliente@exemplo.com` / `123456` (Saldo: R$ 1.000,00)
- **Master**: `master@exemplo.com` / `123456`

### üîß Comandos de Migrations e Seeders

#### Migrations
```bash
# Executar migrations
docker-compose exec backend php bin/hyperf.php migrate

# Criar nova migration
docker-compose exec backend php bin/hyperf.php gen:migration nome_da_migration

# Ver status das migrations
docker-compose exec backend php bin/hyperf.php migrate:status

# Rollback da √∫ltima migration
docker-compose exec backend php bin/hyperf.php migrate:rollback
```

#### Seeders
```bash
# Executar seeders
docker-compose exec backend php bin/hyperf.php db:seed

# Criar novo seeder
docker-compose exec backend php bin/hyperf.php gen:seeder NomeSeeder
```

## üìÅ Estrutura do Projeto

```
user-withdrawal-control/
‚îú‚îÄ‚îÄ backend/                 # API PHP Hyperf 3
‚îÇ   ‚îú‚îÄ‚îÄ app/
‚îÇ   ‚îÇ   ‚îú‚îÄ‚îÄ Controller/      # Controladores da API
‚îÇ   ‚îÇ   ‚îÇ   ‚îú‚îÄ‚îÄ AuthController.php      # Autentica√ß√£o
‚îÇ   ‚îÇ   ‚îÇ   ‚îú‚îÄ‚îÄ AbstractController.php  # Controller base
‚îÇ   ‚îÇ   ‚îÇ   ‚îú‚îÄ‚îÄ Client/                 # Controladores do cliente
‚îÇ   ‚îÇ   ‚îÇ   ‚îÇ   ‚îú‚îÄ‚îÄ AccountController.php   # Opera√ß√µes de conta
‚îÇ   ‚îÇ   ‚îÇ   ‚îÇ   ‚îî‚îÄ‚îÄ TransactionController.php # Dep√≥sitos e saques
‚îÇ   ‚îÇ   ‚îÇ   ‚îî‚îÄ‚îÄ Master/                 # Controladores do master
‚îÇ   ‚îÇ   ‚îÇ       ‚îî‚îÄ‚îÄ TransactionController.php # Dashboard e estat√≠sticas
‚îÇ   ‚îÇ   ‚îî‚îÄ‚îÄ Model/          # Modelos de dados
‚îÇ   ‚îÇ       ‚îú‚îÄ‚îÄ User.php                # Usu√°rios
‚îÇ   ‚îÇ       ‚îú‚îÄ‚îÄ Account.php             # Contas digitais
‚îÇ   ‚îÇ       ‚îú‚îÄ‚îÄ Transaction.php         # Transa√ß√µes
‚îÇ   ‚îÇ       ‚îî‚îÄ‚îÄ WithdrawalDetails.php   # Detalhes PIX
‚îÇ   ‚îú‚îÄ‚îÄ config/             # Configura√ß√µes do Hyperf
‚îÇ   ‚îÇ   ‚îú‚îÄ‚îÄ autoload/
‚îÇ   ‚îÇ   ‚îÇ   ‚îú‚îÄ‚îÄ databases.php          # Configura√ß√£o MySQL
‚îÇ   ‚îÇ   ‚îÇ   ‚îú‚îÄ‚îÄ redis.php              # Configura√ß√£o Redis
‚îÇ   ‚îÇ   ‚îÇ   ‚îî‚îÄ‚îÄ jwt.php                # Configura√ß√£o JWT
‚îÇ   ‚îÇ   ‚îî‚îÄ‚îÄ routes.php                 # Rotas da API
‚îÇ   ‚îú‚îÄ‚îÄ migrations/         # Migrations do banco de dados
‚îÇ   ‚îÇ   ‚îú‚îÄ‚îÄ create_users_table.php
‚îÇ   ‚îÇ   ‚îú‚îÄ‚îÄ add_user_type_to_users_table.php
‚îÇ   ‚îÇ   ‚îú‚îÄ‚îÄ create_accounts_table.php
‚îÇ   ‚îÇ   ‚îú‚îÄ‚îÄ create_transactions_table.php
‚îÇ   ‚îÇ   ‚îî‚îÄ‚îÄ create_withdrawal_details_table.php
‚îÇ   ‚îú‚îÄ‚îÄ seeders/            # Seeders para dados iniciais
‚îÇ   ‚îÇ   ‚îî‚îÄ‚îÄ user_seeder.php            # Usu√°rios de teste
‚îÇ   ‚îú‚îÄ‚îÄ Dockerfile
‚îÇ   ‚îî‚îÄ‚îÄ composer.json
‚îú‚îÄ‚îÄ frontend/               # Interface React
‚îÇ   ‚îú‚îÄ‚îÄ src/
‚îÇ   ‚îÇ   ‚îú‚îÄ‚îÄ components/     # Componentes reutiliz√°veis
‚îÇ   ‚îÇ   ‚îÇ   ‚îú‚îÄ‚îÄ ui/         # Componentes shadcn/ui
‚îÇ   ‚îÇ   ‚îÇ   ‚îÇ   ‚îú‚îÄ‚îÄ button.tsx         # Bot√£o
‚îÇ   ‚îÇ   ‚îÇ   ‚îÇ   ‚îú‚îÄ‚îÄ card.tsx           # Card
‚îÇ   ‚îÇ   ‚îÇ   ‚îÇ   ‚îú‚îÄ‚îÄ input.tsx          # Input
‚îÇ   ‚îÇ   ‚îÇ   ‚îÇ   ‚îú‚îÄ‚îÄ select.tsx         # Select
‚îÇ   ‚îÇ   ‚îÇ   ‚îÇ   ‚îú‚îÄ‚îÄ badge.tsx          # Badge
‚îÇ   ‚îÇ   ‚îÇ   ‚îÇ   ‚îú‚îÄ‚îÄ pagination.tsx     # Pagina√ß√£o
‚îÇ   ‚îÇ   ‚îÇ   ‚îÇ   ‚îú‚îÄ‚îÄ date-picker.tsx    # Seletor de data
‚îÇ   ‚îÇ   ‚îÇ   ‚îÇ   ‚îú‚îÄ‚îÄ input-group.tsx    # Grupo de input
‚îÇ   ‚îÇ   ‚îÇ   ‚îÇ   ‚îú‚îÄ‚îÄ confirmation-modal.tsx # Modal de confirma√ß√£o
‚îÇ   ‚îÇ   ‚îÇ   ‚îÇ   ‚îú‚îÄ‚îÄ dialog.tsx         # Modal/Dialog
‚îÇ   ‚îÇ   ‚îÇ   ‚îÇ   ‚îî‚îÄ‚îÄ export-modal.tsx   # Modal de exporta√ß√£o
‚îÇ   ‚îÇ   ‚îÇ   ‚îú‚îÄ‚îÄ layout/     # Componentes de layout
‚îÇ   ‚îÇ   ‚îÇ   ‚îÇ   ‚îú‚îÄ‚îÄ Sidebar.tsx        # Barra lateral
‚îÇ   ‚îÇ   ‚îÇ   ‚îÇ   ‚îî‚îÄ‚îÄ Navbar.tsx         # Barra superior
‚îÇ   ‚îÇ   ‚îÇ   ‚îú‚îÄ‚îÄ theme-provider.tsx     # Provedor de tema
‚îÇ   ‚îÇ   ‚îÇ   ‚îî‚îÄ‚îÄ theme-toggle.tsx       # Toggle dark/light
‚îÇ   ‚îÇ   ‚îú‚îÄ‚îÄ pages/          # P√°ginas da aplica√ß√£o
‚îÇ   ‚îÇ   ‚îÇ   ‚îú‚îÄ‚îÄ Login.tsx              # P√°gina de login
‚îÇ   ‚îÇ   ‚îÇ   ‚îú‚îÄ‚îÄ Register.tsx           # P√°gina de cadastro
‚îÇ   ‚îÇ   ‚îÇ   ‚îú‚îÄ‚îÄ DashboardRouter.tsx    # Roteador de dashboards
‚îÇ   ‚îÇ   ‚îÇ   ‚îú‚îÄ‚îÄ Client/                # P√°ginas do cliente
‚îÇ   ‚îÇ   ‚îÇ   ‚îÇ   ‚îú‚îÄ‚îÄ Dashboard.tsx      # Dashboard do cliente
‚îÇ   ‚îÇ   ‚îÇ   ‚îÇ   ‚îú‚îÄ‚îÄ DepositPage.tsx    # P√°gina de dep√≥sito
‚îÇ   ‚îÇ   ‚îÇ   ‚îÇ   ‚îú‚îÄ‚îÄ WithdrawPage.tsx   # P√°gina de saque
‚îÇ   ‚îÇ   ‚îÇ   ‚îÇ   ‚îî‚îÄ‚îÄ StatementPage.tsx  # P√°gina de extrato
‚îÇ   ‚îÇ   ‚îÇ   ‚îî‚îÄ‚îÄ Master/                # P√°ginas do master
‚îÇ   ‚îÇ   ‚îÇ       ‚îî‚îÄ‚îÄ Dashboard.tsx      # Dashboard administrativo
‚îÇ   ‚îÇ   ‚îú‚îÄ‚îÄ hooks/          # Hooks customizados
‚îÇ   ‚îÇ   ‚îÇ   ‚îú‚îÄ‚îÄ useAuth.ts             # Hook de autentica√ß√£o
‚îÇ   ‚îÇ   ‚îÇ   ‚îî‚îÄ‚îÄ useExport.ts           # Hook de exporta√ß√£o
‚îÇ   ‚îÇ   ‚îú‚îÄ‚îÄ lib/            # Utilit√°rios
‚îÇ   ‚îÇ   ‚îÇ   ‚îî‚îÄ‚îÄ utils.ts               # Fun√ß√µes utilit√°rias
‚îÇ   ‚îÇ   ‚îú‚îÄ‚îÄ helpers/        # Helpers espec√≠ficos
‚îÇ   ‚îÇ   ‚îÇ   ‚îî‚îÄ‚îÄ currency.ts            # Formata√ß√£o monet√°ria
‚îÇ   ‚îÇ   ‚îú‚îÄ‚îÄ utils/          # Utilit√°rios espec√≠ficos
‚îÇ   ‚îÇ   ‚îÇ   ‚îî‚îÄ‚îÄ api.ts                 # Configura√ß√£o da API
‚îÇ   ‚îÇ   ‚îî‚îÄ‚îÄ App.tsx         # Componente principal
‚îÇ   ‚îú‚îÄ‚îÄ public/
‚îÇ   ‚îú‚îÄ‚îÄ Dockerfile
‚îÇ   ‚îî‚îÄ‚îÄ package.json
‚îú‚îÄ‚îÄ nginx/                  # Configura√ß√£o do Nginx
‚îÇ   ‚îî‚îÄ‚îÄ nginx.conf
‚îú‚îÄ‚îÄ docker-compose.yml      # Orquestra√ß√£o dos servi√ßos
‚îú‚îÄ‚îÄ setup.sh               # Script de configura√ß√£o autom√°tica
‚îî‚îÄ‚îÄ README.md
```

## üÜï Melhorias Recentes

### ‚ú® M√≥dulo de Gest√£o de Clientes (Master)
- **CRUD completo**: Listagem, visualiza√ß√£o, edi√ß√£o e cadastro de clientes
- **Cadastro simplificado**: Apenas nome e email (senha definida no primeiro acesso)
- **Sistema de primeiro acesso**: Cliente define sua pr√≥pria senha no primeiro login
- **Pagina√ß√£o avan√ßada**: Sistema robusto com navega√ß√£o por p√°ginas
- **Filtros e busca**: Busca por nome/email e ordena√ß√£o por data/nome
- **Navega√ß√£o intuitiva**: Bot√µes de voltar e editar nos headers das p√°ginas
- **Formul√°rios responsivos**: Layout em grade com campos organizados
- **Valida√ß√£o em tempo real**: Feedback imediato para o usu√°rio

### üìä M√≥dulo de Transa√ß√µes Master
- **Listagem completa**: Visualiza√ß√£o de todas as transa√ß√µes do sistema
- **Filtros avan√ßados**: Busca por cliente, tipo (DEPOSITO/SAQUE), status e ordena√ß√£o
- **Pagina√ß√£o robusta**: Sistema completo com navega√ß√£o por p√°ginas e ellipsis
- **Interface consistente**: Design alinhado com outros m√≥dulos do sistema
- **Cards informativos**: Exibi√ß√£o clara de dados com √≠cones coloridos por tipo/status
- **Bot√£o "Ver Cliente"**: Navega√ß√£o direta para detalhes do cliente
- **Informa√ß√µes detalhadas**: PIX, datas formatadas, motivos de falha
- **Header limpo**: Interface simplificada sem informa√ß√µes redundantes
- **Exporta√ß√£o Excel**: Gera√ß√£o de planilhas com todos os dados filtrados

### üîê Sistema de Autentica√ß√£o Aprimorado
- **Suporte a usu√°rios sem senha**: Cadastro pelo master sem definir senha
- **Primeiro acesso seguro**: Cliente define senha no primeiro login
- **Verifica√ß√£o segura**: Tratamento correto de senhas null
- **Endpoint de defini√ß√£o de senha**: `/api/auth/set-password` para primeiro acesso
- **Mensagens claras**: Feedback adequado para diferentes cen√°rios de login

### üé® Interface e UX Melhoradas
- **Bot√µes de limpeza de filtros**: X no campo de busca e bot√£o "Limpar" geral
- **Layout consistente**: Formul√°rios seguem padr√£o estabelecido
- **Navega√ß√£o otimizada**: Headers com a√ß√µes contextuais
- **Remo√ß√£o de elementos desnecess√°rios**: Tag "Cliente" removida da listagem
- **Responsividade aprimorada**: Layouts adapt√°veis para diferentes telas

### üîß Refatora√ß√£o da Arquitetura
- **Separa√ß√£o de controladores**: Client/ e Master/ para melhor organiza√ß√£o
- **AbstractController**: Centraliza√ß√£o da l√≥gica comum (getUserFromToken)
- **Rotas organizadas**: Prefixos consistentes em todas as rotas
- **Estrutura de pastas**: Frontend organizado por tipo de usu√°rio
- **Banco de dados atualizado**: Campo password permite NULL, status CANCELADO adicionado
- **Corre√ß√£o de conflitos de rotas**: Centraliza√ß√£o no routes.php para evitar conflitos
- **Arquitetura de rotas consistente**: Padr√£o unificado para todos os m√≥dulos

### üêõ Corre√ß√µes e Melhorias
- **Loop infinito resolvido**: Substitui√ß√£o de window.location.href por navigate()
- **Redirecionamentos consistentes**: Uso do React Router em toda aplica√ß√£o
- **Navega√ß√£o com replace**: Evita ac√∫mulo desnecess√°rio no hist√≥rico
- **Tratamento de erros**: Mensagens claras para usu√°rios sem senha
- **Valida√ß√£o robusta**: Verifica√ß√£o segura de senhas null

## üöÄ Status do Projeto

### ‚úÖ Implementado (Perfil CLIENTE)
- **Autentica√ß√£o completa** com JWT
- **Sistema de contas digitais** com saldo
- **Dep√≥sitos imediatos** com valida√ß√£o
- **Saques imediatos** com valida√ß√£o de saldo
- **Saques agendados** (at√© 7 dias)
- **Cancelamento de saques agendados** com confirma√ß√£o
- **Extrato completo** com filtros e pagina√ß√£o
- **Exporta√ß√£o Excel** com PhpSpreadsheet
- **Transa√ß√µes recentes** no dashboard (4 transa√ß√µes)
- **Suporte PIX** (EMAIL, PHONE, CPF, RANDOM)
- **M√°scara monet√°ria** para valores em reais
- **Notifica√ß√µes toast** para feedback
- **Interface moderna** com shadcn/ui
- **Modo escuro/claro**
- **Design responsivo** e acess√≠vel
- **Migrations e seeders** automatizados
- **API REST completa** documentada
- **L√≥gica centralizada** no modelo Account
- **Navega√ß√£o consistente** com prefixos /client

### ‚úÖ Implementado (Perfil MASTER)
- **Dashboard administrativo** com estat√≠sticas em tempo real
- **Total de clientes** cadastrados no sistema
- **Total de fundos** de todas as contas
- **Total de saques agendados** de todos os usu√°rios
- **Transa√ß√µes recentes** de todos os usu√°rios (4 transa√ß√µes)
- **Interface consistente** com o dashboard do cliente
- **Navega√ß√£o consistente** com prefixos /master
- **API REST** para dados administrativos
- **Gest√£o completa de clientes** com CRUD
- **Cadastro simplificado** de clientes (nome e email)
- **Sistema de primeiro acesso** para defini√ß√£o de senha
- **Pagina√ß√£o avan√ßada** para listagem de clientes
- **Filtros e busca** por nome e email
- **Navega√ß√£o intuitiva** com bot√µes de a√ß√£o nos headers
- **Formul√°rios responsivos** com layout em grade
- **Valida√ß√£o de dados** em tempo real
- **M√≥dulo de transa√ß√µes** com listagem completa do sistema
- **Filtros avan√ßados** por cliente, tipo, status e ordena√ß√£o
- **Pagina√ß√£o robusta** com navega√ß√£o por p√°ginas
- **Interface consistente** alinhada com outros m√≥dulos

### üìã Pr√≥ximas Funcionalidades
- **CRON Job** para processar saques agendados automaticamente
- **Notifica√ß√µes por email** para confirma√ß√µes de transa√ß√µes
- **Relat√≥rios financeiros** detalhados e exporta√ß√£o
- **Auditoria** de opera√ß√µes e logs de sistema
- **API de webhooks** para integra√ß√µes externas
- **Relat√≥rios de performance** e m√©tricas
- **Gest√£o de contas** pelo administrador
- **Hist√≥rico global de transa√ß√µes** com filtros avan√ßados

## üîß Desenvolvimento

### Backend (PHP Hyperf)
```bash
cd backend
composer install
php bin/hyperf.php start
```

### Frontend (React)
```bash
cd frontend
npm install
npm start
```

## üê≥ Docker

### Comandos √∫teis
```bash
# Iniciar todos os servi√ßos
docker-compose up -d

# Ver logs
docker-compose logs -f

# Parar servi√ßos
docker-compose down

# Rebuild dos containers
docker-compose up --build

# Acessar container do backend
docker-compose exec backend bash

# Acessar container do frontend
docker-compose exec frontend sh
```

## üîê Seguran√ßa

- Autentica√ß√£o JWT com expira√ß√£o configur√°vel
- Valida√ß√£o de dados no backend
- CORS configurado no Nginx
- Senhas hasheadas com `password_hash()`
- Tokens seguros com chave secreta

## üìä Banco de Dados

### Tabela `users`
```sql
CREATE TABLE users (
    id BIGINT UNSIGNED AUTO_INCREMENT PRIMARY KEY,
    name VARCHAR(255) NOT NULL,
    email VARCHAR(255) UNIQUE NOT NULL,
    password VARCHAR(255) NULL,
    user_type ENUM('CLIENTE', 'MASTER') DEFAULT 'CLIENTE',
    created_at TIMESTAMP DEFAULT CURRENT_TIMESTAMP,
    updated_at TIMESTAMP DEFAULT CURRENT_TIMESTAMP ON UPDATE CURRENT_TIMESTAMP
);
```

### Tabela `accounts`
```sql
CREATE TABLE accounts (
    id BIGINT UNSIGNED AUTO_INCREMENT PRIMARY KEY,
    user_id BIGINT UNSIGNED NOT NULL,
    balance DECIMAL(15,2) DEFAULT 0.00,
    created_at TIMESTAMP DEFAULT CURRENT_TIMESTAMP,
    updated_at TIMESTAMP DEFAULT CURRENT_TIMESTAMP ON UPDATE CURRENT_TIMESTAMP,
    FOREIGN KEY (user_id) REFERENCES users(id) ON DELETE CASCADE
);
```

### Tabela `transactions`
```sql
CREATE TABLE transactions (
    id BIGINT UNSIGNED AUTO_INCREMENT PRIMARY KEY,
    user_id BIGINT UNSIGNED NOT NULL,
    account_id BIGINT UNSIGNED NOT NULL,
    type ENUM('DEPOSITO', 'SAQUE') NOT NULL,
    amount DECIMAL(15,2) NOT NULL,
    status ENUM('PENDENTE', 'PROCESSADO', 'FALHOU', 'CANCELADO') DEFAULT 'PENDENTE',
    scheduled_at TIMESTAMP NULL,
    processed_at TIMESTAMP NULL,
    failure_reason TEXT NULL,
    created_at TIMESTAMP DEFAULT CURRENT_TIMESTAMP,
    updated_at TIMESTAMP DEFAULT CURRENT_TIMESTAMP ON UPDATE CURRENT_TIMESTAMP,
    FOREIGN KEY (user_id) REFERENCES users(id) ON DELETE CASCADE,
    FOREIGN KEY (account_id) REFERENCES accounts(id) ON DELETE CASCADE
);
```

### Tabela `withdrawal_details`
```sql
CREATE TABLE withdrawal_details (
    id BIGINT UNSIGNED AUTO_INCREMENT PRIMARY KEY,
    transaction_id BIGINT UNSIGNED NOT NULL,
    pix_type ENUM('EMAIL', 'PHONE', 'CPF', 'RANDOM') NOT NULL,
    pix_key VARCHAR(255) NOT NULL,
    created_at TIMESTAMP DEFAULT CURRENT_TIMESTAMP,
    updated_at TIMESTAMP DEFAULT CURRENT_TIMESTAMP ON UPDATE CURRENT_TIMESTAMP,
    FOREIGN KEY (transaction_id) REFERENCES transactions(id) ON DELETE CASCADE
);
```

## üåê API Endpoints (Atualizados)

### üîê Autentica√ß√£o
- `POST /api/auth/register` - Cadastro de usu√°rio
- `POST /api/auth/login` - Login de usu√°rio
- `GET /api/auth/me` - Informa√ß√µes do usu√°rio autenticado

### üí∞ Conta (Protegido - Cliente)
- `GET /api/client/account/balance` - Consultar saldo da conta
- `GET /api/client/account/info` - Informa√ß√µes completas da conta

### üí∏ Transa√ß√µes (Protegido - Cliente)
- `POST /api/client/transactions/deposit` - Realizar dep√≥sito
- `POST /api/client/transactions/withdraw` - Realizar saque (imediato/agendado)
- `POST /api/client/transactions/cancel-scheduled` - Cancelar saque agendado
- `GET /api/client/transactions/statement` - Consultar extrato
- `GET /api/client/transactions/export-excel` - Exportar extrato para Excel
- `GET /api/client/transactions/recent` - Transa√ß√µes recentes (dashboard)

### üëë Administra√ß√£o (Protegido - Master)
- `GET /api/master/transactions/stats` - Estat√≠sticas administrativas
- `GET /api/master/transactions/recent` - Transa√ß√µes recentes de todos os usu√°rios
- `GET /api/master/transactions/list` - Listar todas as transa√ß√µes com filtros e pagina√ß√£o
- `GET /api/master/clients/list` - Listar clientes com pagina√ß√£o
- `POST /api/master/clients/create` - Cadastrar novo cliente
- `GET /api/master/clients/{id}` - Visualizar detalhes do cliente
- `PUT /api/master/clients/{id}` - Editar informa√ß√µes do cliente

## üé® Design System

O projeto utiliza o shadcn/ui como base para o design system, garantindo:
- Componentes acess√≠veis
- Design consistente
- Temas claro/escuro
- Responsividade
- Tipografia moderna

### üéØ Funcionalidades de UX/UI Implementadas

#### **üí≥ Interface de Transa√ß√µes**
- **Cards modernos** com hover effects e sombras
- **√çcones coloridos** que seguem o status da transa√ß√£o
- **Badges de status** com cores consistentes
- **Layout responsivo** para todos os dispositivos
- **Anima√ß√µes suaves** para melhor experi√™ncia

#### **üí∞ Formul√°rios Financeiros**
- **M√°scara monet√°ria** autom√°tica para valores em reais
- **Valida√ß√£o em tempo real** com feedback visual
- **Input groups** para formata√ß√£o de valores
- **Date picker** customizado para agendamentos
- **Notifica√ß√µes toast** para feedback de a√ß√µes

#### **üìä Dashboard e Extrato**
- **Pagina√ß√£o** para grandes volumes de dados
- **Filtros avan√ßados** por tipo e status
- **Transa√ß√µes recentes** no dashboard
- **Saldo dispon√≠vel** vs saldo total
- **Cancelamento de saques** com confirma√ß√£o
- **Exporta√ß√£o Excel** com formata√ß√£o profissional

#### **üé® Sistema de Cores**
- **Verde**: Dep√≥sitos processados
- **Vermelho**: Saques processados/falhados
- **Amarelo**: Transa√ß√µes pendentes
- **Cinza**: Transa√ß√µes canceladas
- **Azul**: Informa√ß√µes de agendamento

## üìä Funcionalidade de Exporta√ß√£o Excel

### ‚ú® Caracter√≠sticas
- **Formato Excel real** (.xlsx) usando PhpSpreadsheet
- **Filtros aplicados** - exporta apenas as transa√ß√µes filtradas
- **Formata√ß√£o profissional** com cabe√ßalhos estilizados
- **Download autom√°tico** via XMLHttpRequest
- **Valida√ß√£o de arquivo** para garantir integridade
- **Interface modal** para sele√ß√£o de formato

### üîß Implementa√ß√£o T√©cnica
- **Backend**: PhpSpreadsheet para gera√ß√£o de arquivos Excel
- **Frontend**: XMLHttpRequest com responseType 'blob'
- **Nginx**: Configura√ß√£o otimizada para arquivos bin√°rios
- **Valida√ß√£o**: Verifica√ß√£o de Content-Type e tamanho do arquivo

### üìã Dados Exportados
- ID da transa√ß√£o
- Tipo (Dep√≥sito/Saque)
- Valor formatado em reais
- Status da transa√ß√£o
- Data de cria√ß√£o
- Data de agendamento (se aplic√°vel)
- Data de processamento (se aplic√°vel)
- Tipo PIX e chave PIX
- Motivo da falha (se aplic√°vel)

## üöÄ Deploy

### Produ√ß√£o
1. Configure as vari√°veis de ambiente de produ√ß√£o
2. Altere as senhas padr√£o
3. Configure um dom√≠nio no Nginx
4. Execute `docker-compose up -d`

### Vari√°veis de ambiente importantes para produ√ß√£o:
```env
JWT_SECRET=chave-super-secreta-para-producao
DB_PASSWORD=senha-forte-para-producao
APP_ENV=production
APP_DEBUG=false
```

## ü§ù Contribui√ß√£o

1. Fork o projeto
2. Crie uma branch para sua feature (`git checkout -b feature/AmazingFeature`)
3. Commit suas mudan√ßas (`git commit -m 'Add some AmazingFeature'`)
4. Push para a branch (`git push origin feature/AmazingFeature`)
5. Abra um Pull Request

## üìù Licen√ßa

Este projeto est√° sob a licen√ßa MIT. Veja o arquivo `LICENSE` para mais detalhes.

## üÜò Suporte

Para suporte, abra uma issue no reposit√≥rio ou entre em contato atrav√©s do email.

---

## üéØ Resumo do Projeto

**User Withdrawal Control** √© um sistema financeiro completo que permite:

- ‚úÖ **Gerenciamento de contas digitais** com saldo em tempo real
- ‚úÖ **Dep√≥sitos e saques** via PIX com valida√ß√µes robustas
- ‚úÖ **Saques agendados** para at√© 7 dias no futuro
- ‚úÖ **Cancelamento de saques agendados** com confirma√ß√£o
- ‚úÖ **Extrato completo** com hist√≥rico de transa√ß√µes e pagina√ß√£o
- ‚úÖ **Exporta√ß√£o Excel** com PhpSpreadsheet
- ‚úÖ **Transa√ß√µes recentes** no dashboard
- ‚úÖ **M√°scara monet√°ria** para formata√ß√£o de valores
- ‚úÖ **Notifica√ß√µes toast** para feedback do usu√°rio
- ‚úÖ **Interface moderna** com modo escuro/claro
- ‚úÖ **Design responsivo** e acess√≠vel
- ‚úÖ **API REST** completa e documentada
- ‚úÖ **Arquitetura de microsservi√ßos** containerizada
- ‚úÖ **Migrations e seeders** automatizados
- ‚úÖ **L√≥gica centralizada** para c√°lculos de saldo
- ‚úÖ **Gest√£o completa de clientes** (CRUD) para administradores
- ‚úÖ **Sistema de primeiro acesso** para defini√ß√£o de senha
- ‚úÖ **Cadastro simplificado** de clientes pelo master
- ‚úÖ **Pagina√ß√£o e filtros** avan√ßados
- ‚úÖ **Navega√ß√£o intuitiva** com bot√µes contextuais

### üöÄ Tecnologias Utilizadas

- **Backend**: PHP Hyperf 3 + MySQL + Redis + JWT + Doctrine DBAL + PhpSpreadsheet
- **Frontend**: React 18 + TypeScript + shadcn/ui + Tailwind CSS + React Router + React Hot Toast
- **Infraestrutura**: Docker + Docker Compose + Nginx
- **Banco de Dados**: 4 tabelas com relacionamentos completos
- **API**: 20 endpoints implementados e testados (7 cliente + 7 master + 4 auth)
- **Componentes**: 15+ componentes shadcn/ui customizados
- **Hooks**: 3 hooks customizados (useAuth, useExport, useMasterExport)
- **Arquitetura**: Separa√ß√£o por tipos de usu√°rio (Client/Master)
- **Navega√ß√£o**: Prefixos consistentes (/client e /master)

---

**Desenvolvido com ‚ù§Ô∏è usando PHP Hyperf 3, React e shadcn/ui**
